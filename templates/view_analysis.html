{% extends "base.html" %} {% block title %}View Analysis - {{ analysis.name }}{% endblock %} {%
block content %}
<div class="container mx-auto py-2 flex flex-col h-full">
	<div class="flex justify-between items-center mb-4 pb-2 border-b">
		<h1 class="text-2xl font-bold text-gray-800">
			<span class="text-blue-600">{{ analysis.name }}</span>
		</h1>
		<a href="{{ url_for('main_routes.index') }}"
			class="bg-gray-500 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-150 ease-in-out text-sm">
			<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block mr-1 -mt-0.5" fill="none"
				viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
				<path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
			</svg>
			Back to Home
		</a>
	</div>

	<div class="grid grid-cols-1 md:grid-cols-4 gap-6 flex-grow">
		<!-- Plot Display Area -->
		<div class="md:col-span-3 bg-white p-4 rounded-lg shadow-lg flex flex-col">
			<h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">UMAP Plot</h2>
			<div id="umap-plot-container" class="w-full flex-grow bg-gray-100 rounded flex items-center justify-center">
				<div class="w-full h-full" id="scatterPlot"></div>
			</div>
			<div class="mt-4">
				<p class="text-sm text-gray-600">
					<strong>Status:</strong>
					<span
						class="font-semibold {% if analysis.status == 'Completed' %} text-green-600 {% elif analysis.status == 'Failed' %} text-red-600 {% elif analysis.status == 'Running' %} text-blue-600 {% else %} text-yellow-600 {% endif %}">
						{{ analysis.status }}</span>
				</p>
				<p class="text-xs text-gray-500 mt-1">
					<strong>Created:</strong> {{ analysis.created_at | format_datetime }}
				</p>
				{% if analysis.description %}
				<p class="text-sm text-gray-600 mt-1">
					<strong>Description:</strong> {{ analysis.description }}
				</p>
				{% endif %}
			</div>
		</div>

		<!-- Configuration Panel -->
		<div class="md:col-span-1 bg-white p-4 rounded-lg shadow-lg flex flex-col">
			<h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Plot Configuration</h2>
			<form id="plot-config-form" class="flex flex-col flex-grow">
				<div>
					<!-- Wrapper for form elements -->
					<div class="mb-4">
						<label for="color-by" class="block text-sm font-medium text-gray-700 mb-1">Color by:</label>
						<select id="color-by" name="color_by"
							class="block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
							<option value="louvain">Louvain Clusters</option>
							<option value="gene_expression">Gene Expression</option>
							<!-- Add more options as needed, e.g., metadata columns -->
						</select>
					</div>

					<div id="gene-selection-div" class="mb-4 hidden">
						<label for="gene-name" class="block text-sm font-medium text-gray-700 mb-1">Gene Name:</label>
						<input type="text" id="gene-name" name="gene_name"
							class="block w-full py-2 px-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
							placeholder="Enter gene symbol" />
					</div>

					<div class="mb-4">
						<label for="point-size" class="block text-sm font-medium text-gray-700 mb-1">Point Size:</label>
						<input type="range" id="point-size" name="point_size" min="1" max="10" value="5"
							class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
						<span id="point-size-value" class="text-xs text-gray-500">5</span>
					</div>

					<div class="mb-4">
						<label for="opacity" class="block text-sm font-medium text-gray-700 mb-1">Opacity:</label>
						<input type="range" id="opacity" name="opacity" min="0.1" max="1" value="0.8" step="0.1"
							class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
						<span id="opacity-value" class="text-xs text-gray-500">0.8</span>
					</div>

					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 mb-1">Legend</label>
						<div class="flex items-center">
							<input id="show-legend" name="show_legend" type="checkbox" checked
								class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" />
							<label for="show-legend" class="ml-2 block text-sm text-gray-900">Show Legend</label>
						</div>
					</div>
				</div>
				<!-- End of wrapper for form elements -->
				<button type="submit"
					class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition duration-150 ease-in-out mt-auto">
					Update Plot
				</button>
			</form>
		</div>
	</div>

	<script>
		const analysis = {{ analysis | tojson }};
	</script>
</div>

{% endblock %}